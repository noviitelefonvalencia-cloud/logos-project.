import os
from kivy.app import App
from kivy.uix.label import Label
from kivy.utils import platform

class VesselApp(App):
    def build(self):
        # Initializing data protection structures
        self.prepare_vault()
        
        # UI showing system status
        status = "RESONANCE_ACTIVE" if self.check_core() else "CORE_LOCKED"
        return Label(text=f"Vessel OS: {status}")

    def prepare_vault(self):
        import shutil
        from os.path import join, exists
        from os import makedirs
        
        # Path for the internal license vault
        if platform == 'android':
            vault_path = join(self.user_data_dir, '.license_vault')
            if not exists(vault_path):
                makedirs(vault_path)
            
            # Injection: Moving key from assets to vault
            asset_key = "key.pub"
            target_key = join(vault_path, "key.pub")
            
            if exists(asset_key) and not exists(target_key):
                try:
                    shutil.copy(asset_key, target_key)
                except Exception:
                    pass

    def check_core(self):
        # Logic to be linked with vessel.so
        try:
            import ctypes
            # Path to the compiled C-core
            lib_path = os.path.join(os.getcwd(), 'lib', 'vessel.so')
            if os.path.exists(lib_path):
                vessel = ctypes.CDLL(lib_path)
                return vessel.core_main() == 1
            return False
        except Exception:
            return False

if __name__ == '__main__':
    VesselApp().run()
